<!--
	Capability for agent management system (AMS) functionality.
	Defines some services that should be available on any platform
	(create/search/destroy agents).
-->
<capability xmlns="http://jadex.sourceforge.net/jadex"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://jadex.sourceforge.net/jadex 
	                    http://jadex.sourceforge.net/jadex-0.96.xsd"
	package="jadex.adapter.standalone.planlib"
	name="AMS_standalone">

	<imports>
		<import>jadex.adapter.standalone.*</import>
		<import>jadex.adapter.standalone.ams.*</import>
		<import>jadex.adapter.fipa.*</import>
		<import>java.util.*</import>
	</imports>

	<capabilities>
		<capability name="procap" file="jadex.planlib.Protocols"/>
	</capabilities>

	<beliefs>
		<!-- The agents on this platform. -->
		<belief name="ams" class="IAMS">
			<fact>((StandaloneAgentAdapter)$scope.getPlatformAgent()).getPlatform().getAMS()</fact>
		</belief>
		<!-- The agents on this platform. -->
		<beliefset name="agents" class="AMSAgentDescription" exported="true">
			<facts evaluationmode="dynamic">
 				$beliefbase.ams.searchAgents(null, null)
			</facts>
		</beliefset>
		<!-- Timeout for messages. -->
		<beliefref name="timeout" class="Long" exported="true">
			<concrete ref="procap.timeout"/>
		</beliefref>
	</beliefs>
	
	<goals>
		<!-- Create a new agent on the platform. -->
		<achievegoal name="ams_create_agent" exported="true">
			<!-- The agent type (name/path of agent model). -->
			<parameter name="type" class="String"/>
			<!-- The name of the instance to create. -->
			<parameter name="name" class="String" optional="true"/>
			<!-- The initial agent configuration to use. -->
			<parameter name="configuration" class="String" optional="true"/>
			<!-- The AMS agent identifier (only needed for remote requests). -->
			<parameter name="ams" class="AgentIdentifier" optional="true"/> 
			<!-- The identifier of the created agent. -->
			<parameter name="agentidentifier" class="AgentIdentifier" direction="out"/>
			<!-- The arguments for the new agent. -->
			<!--<parameterset name="arguments" class="Object" optional="true"/>-->
			<parameter name="arguments" class="Map" optional="true"/>
			<!-- Flag indicating if the agent should be started after creation. -->
			<parameter name="start" class="boolean">
				<value>true</value>
			</parameter>
		</achievegoal>

		<!-- Start the given agent (only possible when it has previously been created with start=false). -->
		<achievegoal name="ams_start_agent" exported="true">
			<!-- The agent to destroy. -->
			<parameter name="agentidentifier" class="AgentIdentifier"/>
			<!-- The AMS agent identifier (only needed for remote requests). -->
			<parameter name="ams" class="AgentIdentifier" optional="true"/> 
		</achievegoal>

		<!-- Destroy the given agent. -->
		<achievegoal name="ams_destroy_agent" exported="true">
			<!-- The agent to destroy. -->
			<parameter name="agentidentifier" class="AgentIdentifier"/>
			<!-- The AMS agent identifier (only needed for remote requests). -->
			<parameter name="ams" class="AgentIdentifier" optional="true"/> 
		</achievegoal>
		
		<!-- Suspend the given agent. -->
		<achievegoal name="ams_suspend_agent" exported="true">
			<!-- The agent to destroy. -->
			<parameter name="agentidentifier" class="AgentIdentifier"/>
			<!-- The AMS agent identifier (only needed for remote requests). -->
			<parameter name="ams" class="AgentIdentifier" optional="true"/>
			<!-- The possibly changed ams agent description. -->
			<parameter name="agentdescription" class="AMSAgentDescription" direction="out"/>
		</achievegoal>
		
		<!-- Resume the given agent. -->
		<achievegoal name="ams_resume_agent" exported="true">
			<!-- The agent to destroy. -->
			<parameter name="agentidentifier" class="AgentIdentifier"/>
			<!-- The AMS agent identifier (only needed for remote requests). -->
			<parameter name="ams" class="AgentIdentifier" optional="true"/> 
				<!-- The possibly changed ams agent description. -->
			<parameter name="agentdescription" class="AMSAgentDescription" direction="out"/>
		</achievegoal>

		<!-- Search for agents on the platform. -->
		<achievegoal name="ams_search_agents" exported="true">
			<!-- The template description to search for. -->
			<parameter name="description" class="AMSAgentDescription"/>
			<!-- The search constraints. -->
			<parameter name="constraints" class="SearchConstraints" optional="true"/>
			<!-- The AMS agent identifier (only needed for remote requests). -->
			<parameter name="ams" class="AgentIdentifier" optional="true"/> 
			<!-- The search results. -->
			<parameterset name="result" class="AMSAgentDescription" direction="out"/>
		</achievegoal>
		
		<!-- Shutdown the platform. -->
		<achievegoal name="ams_shutdown_platform" exported="true">
 			<!-- The AMS agent identifier (only needed for remote requests). -->
			<parameter name="ams" class="AgentIdentifier" optional="true"/>
		</achievegoal>

		<achievegoalref name="rp_initiate">
			<concrete ref="procap.rp_initiate"/>
		</achievegoalref>
	</goals>

	<plans>
		<plan name="local_create_agent_plan">
			<parameter name="type" class="String">
 				<goalmapping ref="ams_create_agent.type"/>
			</parameter>
			<parameter name="name" class="String">
 				<goalmapping ref="ams_create_agent.name"/>
			</parameter>
			<parameter name="configuration" class="String">
 				<goalmapping ref="ams_create_agent.configuration"/>
			</parameter>
			<parameter name="agentidentifier" class="AgentIdentifier">
 				<goalmapping ref="ams_create_agent.agentidentifier"/>
			</parameter>
			<parameter name="ams" class="AgentIdentifier">
 				<goalmapping ref="ams_create_agent.ams"/>
			</parameter>
			<parameter name="arguments" class="Map">
 				<goalmapping ref="ams_create_agent.arguments"/>
			</parameter>
			<parameter name="start" class="boolean">
 				<goalmapping ref="ams_create_agent.start"/>
			</parameter>
			<body class="StandaloneAMSLocalCreateAgentPlan" />
			<!-- <body>new StandaloneAMSLocalCreateAgentPlan()</body> -->
			<trigger>
				<goal ref="ams_create_agent"/>
			</trigger>
			<precondition>$goal.ams==null</precondition>
		</plan>

		<plan name="local_start_agent_plan">
			<parameter name="agentidentifier" class="AgentIdentifier">
 				<goalmapping ref="ams_start_agent.agentidentifier"/>
			</parameter>
			<parameter name="ams" class="AgentIdentifier">
 				<goalmapping ref="ams_start_agent.ams"/>
			</parameter>
			<body class="StandaloneAMSLocalStartAgentPlan" />
			<!-- <body>new StandaloneAMSLocalStartAgentPlan()</body>-->
			<trigger>
				<goal ref="ams_start_agent"/>
			</trigger>
			<precondition>$goal.ams==null</precondition>
		</plan>
		
		<plan name="local_destroy_agent_plan">
			<parameter name="agentidentifier" class="AgentIdentifier">
 				<goalmapping ref="ams_destroy_agent.agentidentifier"/>
			</parameter>
			<parameter name="ams" class="AgentIdentifier">
 				<goalmapping ref="ams_destroy_agent.ams"/>
			</parameter>
			<body class="StandaloneAMSLocalDestroyAgentPlan" />
			<!-- <body>new StandaloneAMSLocalDestroyAgentPlan()</body> -->
			<trigger>
				<goal ref="ams_destroy_agent"/>
			</trigger>
			<precondition>$goal.ams==null</precondition>
		</plan>
		
		<plan name="local_suspend_agent_plan">
			<parameter name="agentidentifier" class="AgentIdentifier">
 				<goalmapping ref="ams_suspend_agent.agentidentifier"/>
			</parameter>
			<parameter name="ams" class="AgentIdentifier">
 				<goalmapping ref="ams_suspend_agent.ams"/>
			</parameter>
			<parameter name="agentdescription" class="AMSAgentDescription">
				<goalmapping ref="ams_suspend_agent.agentdescription"/>
			</parameter>
			<body class="StandaloneAMSLocalSuspendAgentPlan" />
			<trigger>
				<goal ref="ams_suspend_agent"/>
			</trigger>
			<precondition>$goal.ams==null</precondition>
		</plan>
		
		<plan name="local_resume_agent_plan">
			<parameter name="agentidentifier" class="AgentIdentifier">
 				<goalmapping ref="ams_resume_agent.agentidentifier"/>
			</parameter>
			<parameter name="ams" class="AgentIdentifier">
 				<goalmapping ref="ams_resume_agent.ams"/>
			</parameter>
			<parameter name="agentdescription" class="AMSAgentDescription">
				<goalmapping ref="ams_resume_agent.agentdescription"/>
			</parameter>
			<body class="StandaloneAMSLocalResumeAgentPlan" />
			<!-- <body>new StandaloneAMSLocalResumeAgentPlan()</body> -->
			<trigger>
				<goal ref="ams_resume_agent"/>
			</trigger>
			<precondition>$goal.ams==null</precondition>
		</plan>

		<plan name="local_search_agents_plan">
			<parameter name="description" class="AMSAgentDescription">
 				<goalmapping ref="ams_search_agents.description"/>
			</parameter>
			<parameter name="constraints" class="SearchConstraints">
 				<goalmapping ref="ams_search_agents.constraints"/>
			</parameter>
			<parameter name="ams" class="AgentIdentifier">
 				<goalmapping ref="ams_search_agents.ams"/>
			</parameter>
			<parameterset name="result" class="AgentDescription">
 				<goalmapping ref="ams_search_agents.result"/>
			</parameterset>
			<body class="StandaloneAMSLocalSearchAgentsPlan" />
			<!-- <body>new StandaloneAMSLocalSearchAgentsPlan()</body> -->
			<trigger>
				<goal ref="ams_search_agents"/>
			</trigger>
			<precondition>$goal.ams==null</precondition>
		</plan>

		<plan name="local_shutdown_platform_plan">
			<parameter name="ams" class="AgentIdentifier">
 				<goalmapping ref="ams_shutdown_platform.ams"/>
			</parameter>
			<body class="StandaloneAMSLocalShutdownPlatformPlan" />
			<!-- <body>new StandaloneAMSLocalShutdownPlatformPlan()</body> -->
			<trigger>
				<goal ref="ams_shutdown_platform"/>
			</trigger>
			<precondition>$goal.ams==null</precondition>
		</plan>

		<!-- Remote plans -->

		<plan name="remote_create_agent_plan">
			<parameter name="type" class="String">
 				<goalmapping ref="ams_create_agent.type"/>
			</parameter>
			<parameter name="name" class="String">
 				<goalmapping ref="ams_create_agent.name"/>
			</parameter>
			<parameter name="configuration" class="String">
 				<goalmapping ref="ams_create_agent.configuration"/>
			</parameter>
			<parameter name="agentidentifier" class="AgentIdentifier">
 				<goalmapping ref="ams_create_agent.agentidentifier"/>
			</parameter>
			<parameter name="ams" class="AgentIdentifier">
 				<goalmapping ref="ams_create_agent.ams"/>
			</parameter>
			<parameter name="arguments" class="Map">
 				<goalmapping ref="ams_create_agent.arguments"/>
			</parameter>
			<parameter name="start" class="boolean">
 				<goalmapping ref="ams_create_agent.start"/>
			</parameter>
			<body class="StandaloneAMSRemoteCreateAgentPlan" />
			<!-- <body>new StandaloneAMSRemoteCreateAgentPlan()</body> -->
			<trigger>
				<goal ref="ams_create_agent"/>
			</trigger>
			<precondition>$goal.ams!=null</precondition>
		</plan>

		<plan name="remote_start_agent_plan">
			<parameter name="agentidentifier" class="AgentIdentifier">
 				<goalmapping ref="ams_start_agent.agentidentifier"/>
			</parameter>
			<parameter name="ams" class="AgentIdentifier">
 				<goalmapping ref="ams_start_agent.ams"/>
			</parameter>
			<body class="StandaloneAMSRemoteStartAgentPlan" />
			<!-- <body>new StandaloneAMSRemoteStartAgentPlan()</body> -->
			<trigger>
				<goal ref="ams_start_agent"/>
			</trigger>
			<precondition>$goal.ams!=null</precondition>
		</plan>
		
		<plan name="remote_destroy_agent_plan">
			<parameter name="agentidentifier" class="AgentIdentifier">
 				<goalmapping ref="ams_destroy_agent.agentidentifier"/>
			</parameter>
			<parameter name="ams" class="AgentIdentifier">
 				<goalmapping ref="ams_destroy_agent.ams"/>
			</parameter>
			<body class="StandaloneAMSRemoteDestroyAgentPlan" />
			<!-- <body>new StandaloneAMSRemoteDestroyAgentPlan()</body> -->
			<trigger>
				<goal ref="ams_destroy_agent"/>
			</trigger>
			<precondition>$goal.ams!=null</precondition>
		</plan>
		
		<plan name="remote_suspend_agent_plan">
			<parameter name="agentidentifier" class="AgentIdentifier">
 				<goalmapping ref="ams_suspend_agent.agentidentifier"/>
			</parameter>
			<parameter name="ams" class="AgentIdentifier">
 				<goalmapping ref="ams_suspend_agent.ams"/>
			</parameter>
			<parameter name="agentdescription" class="AMSAgentDescription">
				<goalmapping ref="ams_suspend_agent.agentdescription"/>
			</parameter>
			<body class="StandaloneAMSRemoteSuspendAgentPlan" />
			<!-- <body>new StandaloneAMSRemoteSuspendAgentPlan()</body> -->
			<trigger>
				<goal ref="ams_suspend_agent"/>
			</trigger>
			<precondition>$goal.ams!=null</precondition>
		</plan>
		
		<plan name="remote_resume_agent_plan">
			<parameter name="agentidentifier" class="AgentIdentifier">
 				<goalmapping ref="ams_resume_agent.agentidentifier"/>
			</parameter>
			<parameter name="ams" class="AgentIdentifier">
 				<goalmapping ref="ams_resume_agent.ams"/>
			</parameter>
			<parameter name="agentdescription" class="AMSAgentDescription">
				<goalmapping ref="ams_resume_agent.agentdescription"/>
			</parameter>
			<body class="StandaloneAMSRemoteResumeAgentPlan" />
			<!-- <body>new StandaloneAMSRemoteResumeAgentPlan()</body> -->
			<trigger>
				<goal ref="ams_resume_agent"/>
			</trigger>
			<precondition>$goal.ams!=null</precondition>
		</plan>

		<plan name="remote_search_agents_plan">
			<parameter name="description" class="AMSAgentDescription">
 				<goalmapping ref="ams_search_agents.description"/>
			</parameter>
			<parameter name="constraints" class="SearchConstraints">
 				<goalmapping ref="ams_search_agents.constraints"/>
			</parameter>
			<parameter name="ams" class="AgentIdentifier">
 				<goalmapping ref="ams_search_agents.ams"/>
			</parameter>
			<parameterset name="result" class="AgentDescription">
 				<goalmapping ref="ams_search_agents.result"/>
			</parameterset>
			<body class="StandaloneAMSRemoteSearchAgentsPlan" />
			<!-- <body>new StandaloneAMSRemoteSearchAgentsPlan()</body> -->
			<trigger>
				<goal ref="ams_search_agents"/>
			</trigger>
			<precondition>$goal.ams!=null</precondition>
		</plan>

		<plan name="remote_shutdown_platform_plan">
			<parameter name="ams" class="AgentIdentifier">
 				<goalmapping ref="ams_shutdown_platform.ams"/>
			</parameter>
			<body class="StandaloneAMSRemoteShutdownPlatformPlan" />
			<!-- <body>new StandaloneAMSRemoteShutdownPlatformPlan()</body> -->
			<trigger>
				<goal ref="ams_shutdown_platform"/>
			</trigger>
			<precondition>$goal.ams!=null</precondition>
		</plan>
	</plans>
	
	<expressions>
		<condition name="agent_removed">
			!$beliefbase.ams.containsAgent(aid)
			<parameter name="aid" class="AgentIdentifier"/>
		</condition>
	</expressions>

	<properties>
		<property name="logging.level.exceptions">java.util.logging.Level.WARNING</property>
	</properties>

	<configurations>
		<configuration name="default"/>
		<configuration name="agentlist"/>
	</configurations>

</capability>
